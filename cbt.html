04.25 13.52
cbt.html
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBT - Musholla Nurul Ikhwan</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f5f5f5;
    }
    header {
      background: #00264d;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .opsi label {
      display: block;
      background: #f0f0f0;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    button {
      padding: 10px 16px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      background: #004080;
      color: white;
      margin: 5px;
      cursor: pointer;
    }
    #submitBtn {
      background: crimson;
      width: 100%;
      margin-top: 20px;
    }
    img.soal-gambar {
      max-width: 100%;
      margin: 10px 0;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>
    <div><strong>CBT - Musholla Nurul Ikhwan</strong></div>
    <div id="timer">00:00</div>
  </header>

  <div class="container">
    <div class="card" id="soalContainer"></div>
    <div style="text-align:center">
      <button onclick="sebelumnya()">Sebelumnya</button>
      <button onclick="selanjutnya()">Selanjutnya</button>
    </div>
    <button id="submitBtn" onclick="submit()">Kumpulkan Jawaban</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC-PGsyOliTaj-unpWwuB3cb9N11Gcpl7M",
      authDomain: "cbt-musholla.firebaseapp.com",
      projectId: "cbt-musholla",
      storageBucket: "cbt-musholla.firebasestorage.app",
      messagingSenderId: "1012621765788",
      appId: "1:1012621765788:web:86ef7078db1811847d1159"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    const user = localStorage.getItem("cbt_user");
    const mapel = localStorage.getItem("cbt_mapel");
    const jawaban = {};
    let soal = [], index = 0;

    if (!user || !mapel) window.location.href = "login.html";

    db.collection("jawaban").doc(`${user}_${mapel}`).get().then(d => {
      if (d.exists && d.data().submit) window.location.href = "selesai.html";
    });

    db.collection("soal").where("mapel", "==", mapel).get().then(snapshot => {
      snapshot.forEach(doc => soal.push({ id: doc.id, ...doc.data() }));
      tampilSoal();
    });

    function tampilSoal() {
      const s = soal[index];
      if (!s) return;
      let html = `<h3>Soal ${index + 1}</h3><p>${s.pertanyaan}</p>`;
      if (s.gambar) html += `<img class="soal-gambar" src="${s.gambar}" alt="Gambar">`;
      html += `<div class="opsi">`;
      for (let k in s.opsi) {
        const checked = jawaban[s.id] === k ? "checked" : "";
        html += `<label><input type="radio" name="soal" value="${k}" ${checked} onchange="simpanJawaban('${s.id}', '${k}')"> ${k}. ${s.opsi[k]}</label>`;
      }
      html += `</div>`;
      document.getElementById("soalContainer").innerHTML = html;
    }

    function simpanJawaban(id, val) {
      jawaban[id] = val;
      db.collection("jawaban").doc(`${user}_${mapel}`).set({
        user, mapel, submit: false, jawaban
      });
    }

    function sebelumnya() {
      if (index > 0) index--;
      tampilSoal();
    }

    function selanjutnya() {
      if (index < soal.length - 1) index++;
      tampilSoal();
    }

    function submit() {
      if (!confirm("Yakin ingin mengumpulkan jawaban?")) return;
      db.collection("jawaban").doc(`${user}_${mapel}`).set({
        user, mapel, submit: true, jawaban
      }, { merge: true }).then(() => {
        localStorage.removeItem("cbt_user");
        localStorage.removeItem("cbt_mapel");
        window.location.href = "selesai.html";
      });
    }

    document.addEventListener("visibilitychange", () => {
      if (document.hidden) {
        alert("Aktivitas mencurigakan terdeteksi. Anda logout.");
        window.location.href = "login.html";
      }
    });

    document.addEventListener("copy", () => {
      alert("Menyalin tidak diizinkan. Anda logout.");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>

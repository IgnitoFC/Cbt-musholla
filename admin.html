04.24 21.46
admin.html
<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin CBT</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-storage-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    .box { background: white; padding: 20px; margin: 20px auto; border-radius: 10px; max-width: 900px; box-shadow: 0 0 10px #ccc; }
    h2, h3 { text-align: center; }
    input, select, textarea, button {
      display: block; width: 100%; padding: 10px; margin: 5px 0; font-size: 16px;
      border-radius: 5px; border: 1px solid #ccc;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #007bff; color: white; }
    .danger { background: red; color: white; border: none; padding: 5px 10px; border-radius: 5px; }
    .warn { background: orange; color: white; border: none; padding: 5px 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Admin CBT Multi Mapel</h2>  <div class="box">
    <h3>Kelola Mapel</h3>
    <input type="text" id="namaMapelBaru" placeholder="Nama Mapel Baru" />
    <button onclick="tambahMapel()">Tambah Mapel</button>
    <select id="mapelSelect" onchange="muatSemua()"></select>
    <button class="danger" onclick="hapusMapel()">Hapus Mapel Ini & Semua Datanya</button>
  </div>  <div class="box">
    <h3>Kelola Soal</h3>
    <input type="number" id="nomor" placeholder="Nomor Soal" />
    <textarea id="pertanyaan" placeholder="Pertanyaan"></textarea>
    <input type="file" id="gambarSoal" />
    <button onclick="uploadGambar()">Upload Gambar Soal</button>
    <input type="text" id="opsiA" placeholder="Opsi A" />
    <input type="text" id="opsiB" placeholder="Opsi B" />
    <input type="text" id="opsiC" placeholder="Opsi C" />
    <input type="text" id="opsiD" placeholder="Opsi D" />
    <select id="tipe">
      <option value="pg">Pilihan Ganda</option>
      <option value="pgk">PG Kompleks</option>
      <option value="bs">Benar/Salah</option>
    </select>
    <input type="text" id="kunci" placeholder="Kunci Jawaban (contoh: A atau A,B)" />
    <button onclick="simpanSoal()">Simpan Soal</button>
    <table id="tabelSoal"><thead><tr><th>No</th><th>Soal</th><th>Kunci</th><th>Aksi</th></tr></thead><tbody></tbody></table>
  </div>  <div class="box">
    <h3>Kelola Akun Peserta</h3>
    <input type="text" id="usernameBaru" placeholder="Username" />
    <input type="password" id="passwordBaru" placeholder="Password" />
    <button onclick="tambahAkun()">Tambah Akun</button>
    <table id="tabelAkun"><thead><tr><th>Username</th><th>Password</th><th>Aksi</th></tr></thead><tbody></tbody></table>
  </div>  <div class="box">
    <h3>Pengaturan Token & Waktu</h3>
    <input type="text" id="token" placeholder="Token" />
    <input type="datetime-local" id="mulai" />
    <input type="datetime-local" id="selesai" />
    <button onclick="simpanPengaturan()">Simpan Pengaturan</button>
  </div>  <div class="box">
    <h3>Nilai Peserta</h3>
    <table id="tabelNilai"><thead><tr><th>No</th><th>Username</th><th>Nilai</th><th>Waktu</th></tr></thead><tbody></tbody></table>
  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC-PGsyOliTaj-unpWwuB3cb9N11Gcpl7M",
      authDomain: "cbt-musholla.firebaseapp.com",
      projectId: "cbt-musholla",
      storageBucket: "cbt-musholla.appspot.com",
      messagingSenderId: "1012621765788",
      appId: "1:1012621765788:web:86ef7078db1811847d1159"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    function mapelAktif() { return document.getElementById("mapelSelect").value; }

    async function tambahMapel() {
      const nama = document.getElementById("namaMapelBaru").value;
      if (!nama) return alert("Isi nama mapel!");
      await db.collection("mapel").doc(nama.toLowerCase()).set({ nama });
      muatMapel(); alert("Mapel ditambahkan!");
    }

    async function hapusMapel() {
      const m = mapelAktif();
      if (!confirm("Yakin ingin menghapus mapel dan semua datanya?")) return;
      await db.collection("mapel").doc(m).delete();
      const koleksi = ["soal_", "nilai_", "pengaturan_"];
      for (const k of koleksi) {
        const snap = await db.collection(k + m).get();
        snap.forEach(doc => db.collection(k + m).doc(doc.id).delete());
      }
      alert("Mapel dan datanya dihapus!");
      muatMapel();
    }

    function uploadGambar() {
      const file = document.getElementById("gambarSoal").files[0];
      if (!file) return alert("Pilih file!");
      const ref = storage.ref("gambar_soal/" + Date.now() + "_" + file.name);
      ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
        const t = document.getElementById("pertanyaan");
        t.value += `<img src="${url}" width="300" />`;
        alert("Gambar dimasukkan ke soal!");
      });
    }

    function simpanSoal() {
      const m = mapelAktif();
      const nomor = document.getElementById("nomor").value;
      const pertanyaan = document.getElementById("pertanyaan").value;
      const opsi = {
        A: document.getElementById("opsiA").value,
        B: document.getElementById("opsiB").value,
        C: document.getElementById("opsiC").value,
        D: document.getElementById("opsiD").value
      };
      const tipe = document.getElementById("tipe").value;
      const kunciRaw = document.getElementById("kunci").value.toUpperCase();
      const kunci = tipe === "pgk" ? kunciRaw.split(",") : kunciRaw;
      db.collection("soal_" + m).doc(nomor).set({ nomor, pertanyaan, opsi, tipe, kunci })
        .then(() => { alert("Soal disimpan!"); muatSoal(); });
    }

    function tambahAkun() {
      const u = document.getElementById("usernameBaru").value;
      const p = document.getElementById("passwordBaru").value;
      db.collection("akun").doc(u).set({ password: p }).then(() => {
        alert("Akun ditambahkan!"); muatAkun();
      });
    }

    function hapusAkun(u) {
      if (confirm("Hapus akun " + u + "?")) db.collection("akun").doc(u).delete().then(muatAkun);
    }

    function hapusSoal(nomor) {
      const m = mapelAktif();
      if (confirm("Hapus soal " + nomor + "?")) db.collection("soal_" + m).doc(nomor).delete().then(muatSoal);
    }

    function simpanPengaturan() {
      const m = mapelAktif();
      const token = document.getElementById("token").value;
      const mulai = document.getElementById("mulai").value;
      const selesai = document.getElementById("selesai").value;
      db.collection("pengaturan_" + m).doc("token").set({ token });
      db.collection("pengaturan_" + m).doc("waktuUjian").set({ mulai, selesai });
      alert("Pengaturan disimpan!");
    }

    function muatMapel() {
      const select = document.getElementById("mapelSelect");
      select.innerHTML = "";
      db.collection("mapel").get().then(snap => {
        snap.forEach(doc => {
          select.innerHTML += `<option value="${doc.id}">${doc.data().nama}</option>`;
        });
        muatSemua();
      });
    }

    function muatSoal() {
      const m = mapelAktif();
      const tbody = document.querySelector("#tabelSoal tbody");
      tbody.innerHTML = "";
      db.collection("soal_" + m).orderBy("nomor").get().then(snap => {
        snap.forEach(doc => {
          const d = doc.data();
          tbody.innerHTML += `<tr><td>${d.nomor}</td><td>${d.pertanyaan}</td><td>${Array.isArray(d.kunci) ? d.kunci.join(", ") : d.kunci}</td><td><button class='danger' onclick="hapusSoal('${d.nomor}')">Hapus</button></td></tr>`;
        });
      });
    }

    function muatAkun() {
      const tbody = document.querySelector("#tabelAkun tbody");
      tbody.innerHTML = "";
      db.collection("akun").get().then(snap => {
        snap.forEach(doc => {
          const d = doc.data();
          tbody.innerHTML += `<tr><td>${doc.id}</td><td>${d.password}</td><td><button class='danger' onclick="hapusAkun('${doc.id}')">Hapus</button></td></tr>`;
        });
      });
    }

    function muatNilai() {
      const m = mapelAktif();
      const tbody = document.querySelector("#tabelNilai tbody");
      tbody.innerHTML = "";
      db.collection("nilai_" + m).orderBy("waktu", "desc").get().then(snap => {
        let i = 1;
        snap.forEach(doc => {
          const d = doc.data();
          tbody.innerHTML += `<tr><td>${i++}</td><td>${d.username}</td><td>${d.nilai}</td><td>${new Date(d.waktu).toLocaleString()}</td></tr>`;
        });
      });
    }

    function muatSemua() { muatSoal(); muatAkun(); muatNilai(); }
    window.onload = muatMapel;
  </script></body>
</html>
